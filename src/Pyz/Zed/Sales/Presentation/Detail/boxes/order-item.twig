{% set numberOfItemAdditions = not orderItem.relatedBundleItemIdentifier ? (orderItem.productOptions | length + 1) : 1 %}
{% set subtotal = group ? bundleItem.sumSubtotalAggregation : orderItem.sumSubtotalAggregation %}
{% set priceToPay = group ? bundleItem.sumPriceToPayAggregation : orderItem.sumPriceToPayAggregation %}
{% set image = image %}

{% if displayImage %}
    <td {% if group %}rowspan="{{ itemCount }}" {% endif %}><img class="product-image" src="{{ image }}"/></td>
{% endif %}
<td>
    <div>
        <a target="_blank" href="{{ url('/product-management/view/variant', {'id-product-abstract': orderItem.idProductAbstract, 'id-product': orderItem.id, 'type': 'regular'}) }}">
          {{ orderItem.name }}
        </a>
    </div>
    <div class="sku">
       {{ orderItem.Sku }}
    </div>

  {% if orderItem.metadata.superAttributes is not null and orderItem.metadata.superAttributes | length > 0 %}
    <div class="variant-details">
      <h3>{{ 'Variant Details' | trans }}</h3>
      {% for attributeName, attributeValue in orderItem.metadata.superAttributes | slice(0,2) %}
          <div>{{ attributeName }}: {{ attributeValue }}</div>
      {% endfor %}

      {% if orderItem.metadata.superAttributes | length > 2 %}
        <div id="attribute_details_{{ orderItem.IdSalesOrderItem }}" class="hidden">
          {% for attributeName, attributeValue in orderItem.metadata.superAttributes | slice(2) %}
            <div>{{ attributeName }}: {{ attributeValue }}</div>
          {% endfor %}
        </div>

        <a id="attribute-details-btn-{{ orderItem.IdSalesOrderItem }}" class="btn btn-sm more-attributes is-hidden" data-id="{{ orderItem.IdSalesOrderItem }}"><span class="show-more">{{ 'Show more' | trans }}</span><span class="show-less">{{ 'Show less' | trans }}</span></a>
      {% endif %}
    </div>
  {% endif %}
  {% include ['@ProductPackagingUnitGui/Sales/Detail/boxes/item-packaging-unit.twig', '@Sales/Detail/boxes/item-packaging-unit.twig'] with {orderItem: orderItem} %}
</td>
<td class="quantity-balance">
    <span class="picked">0</span>/<span class="quantity">{{ orderItem.quantity }}</span>
  {% embed '@Sales/Detail/boxes/item-measurement-unit.twig' with {orderItem: orderItem} %}{% endembed %}
    <span class="total-weight" style="display: block"></span>
    <span class="cumulative-weight" style="display: block">{{ orderItem.newWeight }}</span>
</td>
<td>
    <div>
      {% embed '@Sales/Detail/boxes/discounted-price.twig' with {subtotal: orderItem.sumPrice, priceToPay: orderItem.sumPrice - orderItem.sumDiscountAmountFullAggregation | default(0)} %} {% endembed %}
    </div>
    <div class="tax-info">{{ "incl. %tax_amount% % tax" | trans({'%tax_amount%': orderItem.taxRate|default(0)}) }}</div>
</td>

{% if displayTotals %}
    <td {% if group %}rowspan="{{ rowCount }}"{% endif %} data-qa="item-total-amount" data-qa-raw="{{ priceToPay }}">
      {% embed '@Sales/Detail/boxes/discounted-price.twig' with {subtotal: subtotal, priceToPay: priceToPay} %} {% endembed %}
    </td>
{% else %}
{% endif %}
<td rowspan="1" class="state-history">
    <div>
        {% if orderItem.itemPaused == true %}
            <a style="color: #1AB394" href="{{ url('/oms/index/draw', {'process': orderItem.process, 'state': orderItem.state.name}) }}" target="_blank" class="item-state">{{ (orderItem.stateHistory | first).name }} (paused)</a>
        {% else %}
            <a style="color: #1AB394" href="{{ url('/oms/index/draw', {'process': orderItem.process, 'state': orderItem.state.name}) }}" target="_blank" class="item-state">{{ (orderItem.stateHistory | first).name }}</a>
        {% endif %}
    </div>
  {% if orderItem.stateHistory | length > 1 %}
      <div id="history_details_{{ orderItem.idSalesOrderItem }}" class="hidden">
        {% for stateHistory in orderItem.stateHistory | slice(1) %}
            <div style="color: #1AB394">{{ stateHistory.name }} ({{ stateHistory.createdAt | formatDateTime }})</div>
        {% endfor %}
      </div>
      <a id="history-btn-{{ orderItem.idSalesOrderItem }}" class="btn btn-sm more-history is-hidden" style="padding-left: 0; color: #1AB394;" data-id="{{ orderItem.IdSalesOrderItem }}"><span class="show-more">{{ 'Show history' | trans }}</span><span class="show-less">{{ 'Hide history' | trans }}</span></a>
  {% endif %}
</td>
<td class="location">
    {{ orderItem.shelf }} - {{ orderItem.shelfFloor }} - {{ orderItem.shelfField }}
</td>
<td class="location">
    {% if orderItem.isSubstitutionFound and orderItem.isSubstitutionFound == '1' %}
        <svg class="replacmenet-icon" version="1.1" id="Ebene_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             viewBox="0 0 64 62" style="enable-background:new 0 0 64 62;" xml:space="preserve">
            <style type="text/css">
                .st0{fill:#EA8801;}
                .st1{enable-background:new;}
                .st2{fill:#FFFFFF;}
            </style>
                <g>
                    <g id="Ellipse_47" transform="translate(2139 17231.387)">
                        <circle class="st0" cx="-2107" cy="-17200.4" r="30.5"/>
                    </g>
                    <g class="st1">
                        <path class="st2" d="M31.8,32.7c-3.6-1-6.3-2.3-7.9-3.8c-1.6-1.5-2.5-3.4-2.5-5.6c0-2.5,1-4.6,3-6.3c2-1.6,4.6-2.5,7.9-2.5
                c2.2,0,4.2,0.4,5.9,1.3s3.1,2,4,3.5c0.9,1.5,1.4,3.1,1.4,4.9h-4.2c0-1.9-0.6-3.5-1.8-4.6c-1.2-1.1-3-1.7-5.2-1.7
                c-2.1,0-3.7,0.5-4.9,1.4c-1.2,0.9-1.7,2.2-1.7,3.8c0,1.3,0.6,2.4,1.7,3.3c1.1,0.9,3,1.7,5.6,2.5c2.7,0.7,4.7,1.6,6.2,2.5
                c1.5,0.9,2.6,2,3.3,3.2c0.7,1.2,1.1,2.6,1.1,4.2c0,2.6-1,4.7-3,6.2c-2,1.6-4.7,2.3-8.1,2.3c-2.2,0-4.2-0.4-6.2-1.3
                c-1.9-0.8-3.4-2-4.4-3.5c-1-1.5-1.5-3.1-1.5-5h4.2c0,1.9,0.7,3.5,2.1,4.6c1.4,1.1,3.3,1.7,5.7,1.7c2.2,0,3.9-0.5,5.1-1.4
                c1.2-0.9,1.8-2.1,1.8-3.7s-0.5-2.8-1.6-3.6C36.6,34.4,34.6,33.6,31.8,32.7z"/>
                    </g>
                </g>
            </svg>
    {% endif %}
</td>
<td></td>
