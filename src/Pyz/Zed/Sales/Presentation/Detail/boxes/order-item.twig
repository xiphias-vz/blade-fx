{% set numberOfItemAdditions = not orderItem.relatedBundleItemIdentifier ? (orderItem.productOptions | length + 1) : 1 %}
{% set subtotal = group ? bundleItem.sumSubtotalAggregation : orderItem.sumSubtotalAggregation %}
{% set priceToPay = group ? bundleItem.sumPriceToPayAggregation : orderItem.sumPriceToPayAggregation %}
{% set image = image %}

{% if displayImage %}
    <td {% if group %}rowspan="{{ itemCount }}" {% endif %}><img class="product-image" src="{{ image }}"/></td>
{% endif %}
<td>
    <div>
        <a target="_blank" href="{{ url('/product-management/view/variant', {'id-product-abstract': orderItem.idProductAbstract, 'id-product': orderItem.id, 'type': 'regular'}) }}">
          {{ orderItem.name }}
        </a>
    </div>
    <div class="sku">
       {{ orderItem.Sku }}
    </div>

  {% if orderItem.metadata.superAttributes is not null and orderItem.metadata.superAttributes | length > 0 %}
    <div class="variant-details">
      <h3>{{ 'Variant Details' | trans }}</h3>
      {% for attributeName, attributeValue in orderItem.metadata.superAttributes | slice(0,2) %}
          <div>{{ attributeName }}: {{ attributeValue }}</div>
      {% endfor %}

      {% if orderItem.metadata.superAttributes | length > 2 %}
        <div id="attribute_details_{{ orderItem.IdSalesOrderItem }}" class="hidden">
          {% for attributeName, attributeValue in orderItem.metadata.superAttributes | slice(2) %}
            <div>{{ attributeName }}: {{ attributeValue }}</div>
          {% endfor %}
        </div>

        <a id="attribute-details-btn-{{ orderItem.IdSalesOrderItem }}" class="btn btn-sm more-attributes is-hidden" data-id="{{ orderItem.IdSalesOrderItem }}"><span class="show-more">{{ 'Show more' | trans }}</span><span class="show-less">{{ 'Show less' | trans }}</span></a>
      {% endif %}
    </div>
  {% endif %}
  {% include ['@ProductPackagingUnitGui/Sales/Detail/boxes/item-packaging-unit.twig', '@Sales/Detail/boxes/item-packaging-unit.twig'] with {orderItem: orderItem} %}
</td>
<td class="quantity-balance">
    <span class="picked">0</span>/<span class="quantity">{{ orderItem.quantity }}</span>
  {% embed '@Sales/Detail/boxes/item-measurement-unit.twig' with {orderItem: orderItem} %}{% endembed %}
    <span class="total-weight" style="display: block"></span>
    <span class="cumulative-weight" style="display: block">{{ orderItem.newWeight }}</span>
</td>
<td>
    <div>
      {% embed '@Sales/Detail/boxes/discounted-price.twig' with {subtotal: orderItem.sumPrice, priceToPay: orderItem.sumPrice - orderItem.sumDiscountAmountFullAggregation | default(0)} %} {% endembed %}
    </div>
    <div class="tax-info">{{ "incl. %tax_amount% % tax" | trans({'%tax_amount%': orderItem.taxRate|default(0)}) }}</div>
</td>

{% if displayTotals %}
    <td {% if group %}rowspan="{{ rowCount }}"{% endif %} data-qa="item-total-amount" data-qa-raw="{{ priceToPay }}">
      {% embed '@Sales/Detail/boxes/discounted-price.twig' with {subtotal: subtotal, priceToPay: priceToPay} %} {% endembed %}
    </td>
{% else %}
{% endif %}
<td rowspan="1" class="state-history">
    <div>
        {% if orderItem.itemPaused == true %}
            <a style="color: #1AB394" href="{{ url('/oms/index/draw', {'process': orderItem.process, 'state': orderItem.state.name}) }}" target="_blank" class="item-state">{{ (orderItem.stateHistory | first).name }} (paused)</a>
        {% else %}
            <a style="color: #1AB394" href="{{ url('/oms/index/draw', {'process': orderItem.process, 'state': orderItem.state.name}) }}" target="_blank" class="item-state">{{ (orderItem.stateHistory | first).name }}</a>
        {% endif %}
    </div>
  {% if orderItem.stateHistory | length > 1 %}
      <div id="history_details_{{ orderItem.idSalesOrderItem }}" class="hidden">
        {% for stateHistory in orderItem.stateHistory | slice(1) %}
            <div style="color: #1AB394">{{ stateHistory.name }} ({{ stateHistory.createdAt | formatDateTime }})</div>
        {% endfor %}
      </div>
      <a id="history-btn-{{ orderItem.idSalesOrderItem }}" class="btn btn-sm more-history is-hidden" style="padding-left: 0; color: #1AB394;" data-id="{{ orderItem.IdSalesOrderItem }}"><span class="show-more">{{ 'Show history' | trans }}</span><span class="show-less">{{ 'Hide history' | trans }}</span></a>
  {% endif %}
</td>
<td class="location">
    {{ orderItem.shelf }} - {{ orderItem.shelfFloor }} - {{ orderItem.shelfField }}
</td>
<td class="location">
    {{ orderItem.shelf }} - {{ orderItem.shelfFloor }} - {{ orderItem.shelfField }}
</td>
<td></td>
