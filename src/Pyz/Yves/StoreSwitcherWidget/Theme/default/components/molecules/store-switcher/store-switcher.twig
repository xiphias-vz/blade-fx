{% extends model('component') %}

{% define config = {
    name: 'store-switcher',
    tag: 'store-switcher'
} %}

{% define data = {
    stores: required,
    currentStore: required,
    pattern: required,
    additionalModifiers: required,
    additionalClassName: '',
} %}

{% block body %}
    {% embed molecule('custom-select') with {
        modifiers: data.additionalModifiers,
        attributes: {
            'config-theme': 'secondary',
            'additional-class-name': data.additionalClassName,
        },
        embed: {
            jsName: config.jsName ~ '__select_store',
            stores: data.stores,
            currentStore: data.currentStore,
            pattern: data.pattern
        }
    } only %}
        {% block selectClass %}
            {{ parent() }} {{ embed.jsName }}
        {% endblock %}
        {% block options %}
            {% if app.request.cookies.get('current_store') == null %}
                <option value="{{ embed.pattern }}" selected>
                    {{ 'please.choose.store' | trans }}
                </option>
            {% endif %}
            {% for storeName, storeTitle in embed.stores %}
                {% if app.request.cookies.get('current_store') == null %}
                    <option value="{{ embed.pattern | format(storeName, app.request.requestUri) }}">
                        {{ storeTitle }}
                    </option>
                {% else %}
                {% set selectedOption = storeName == embed.currentStore ? 'selected' %}
                <option value="{{ embed.pattern | format(storeName, app.request.requestUri) }}" {{ selectedOption }}>
                    {{ storeTitle }}
                </option>
                {% endif %}
            {% endfor %}
        {% endblock %}
    {% endembed %}
{% endblock %}
