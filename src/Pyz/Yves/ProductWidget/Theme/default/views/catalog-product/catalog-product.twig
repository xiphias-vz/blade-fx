{% extends template('widget') %}

{% define data = {
    product: _widget.product,
    viewMode: _widget.viewMode,
    depositPrice: _widget.depositPrice,
    position: _widget.position,
} %}

{% set image = publicPath("/images/kein_bild_vorhanden.png") %}

{% block body %}
    {% set productTemplate = molecule('product-item') %}
    {% set class = 'col--sm-12 col--md-3 col--lg-3' %}

    {% if data.viewMode == 'list' %}
        {% set productTemplate = molecule('product-item-list') %}
        {% set class = 'col col--sm-12' %}
    {% endif %}

    {% if data.product.images is defined %}
        {% set firstImage = data.product.images | first %}
        {% if firstImage.external_url_small is defined %}
            {% set image = firstImage.external_url_small %}
            {% if app.currentCodeBucket == 'DE' %}
                {% set splitUrl = firstImage.external_url_small | split('.com/') %}
                {% set insertInTheMiddle = '.com/thumb_' %}
                {% set newThumbUrl = splitUrl[0] ~ insertInTheMiddle ~ splitUrl[1] %}
                {% set image = newThumbUrl %}
            {% else %}
                {% if image ends with "type=1" %}
                    {% set splitUrl = firstImage.external_url_small | split('type=1') %}
                    {% set typeThreeUrlEnd = 'type=3' %}
                    {% set newThumbUrl = splitUrl[0] ~ typeThreeUrlEnd %}
                    {% set image = newThumbUrl %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}

    {% embed productTemplate with {
        productTemplate: productTemplate,
        class: class,
        data: {
        product: data.product,
        name: data.product.abstract_name,
        idProductAbstract: data.product.id_product_abstract,
        image: image,
        depositPrice: data.depositPrice,
        position: data.position,
    },
    } only %}
        {% block productAbstractLabels %}
            {% widget 'ProductConcreteLabelWidget' args [data.product.id_product_labels] only %}{% endwidget %}
        {% endblock %}

        {% block rating %}
        {% endblock %}
    {% endembed %}
{% endblock %}
