{% extends template('page-layout-catalog', 'CatalogPage') %}

{% define data = {
    products: _view.products,
    facets: _view.facets,
    filterPath: _view.filterPath | default(null),
    category: _view.category | default(null),
    categories: categories | default([]),
    categoryId: _view.idCategory | default(null),
    filterPath: _view.filterPath | default(null),
    viewMode: _view.viewMode | default(null),

    title: _view.category.name | default('catalog.sale' | trans),
    metaTitle: _view.category.name | default('catalog.sale' | trans),
    metaDescription: _view.category.meta_description | default,
    metaKeywords: _view.category.meta_keywords | default,

    pagination: {
        parameters: app.request.query.all(),
        currentPage: _view.pagination.currentPage,
        paginationPath: app.request.attributes.get('_route'),
        maxPage: _view.pagination.maxPage,
        showAlwaysFirstAndLast: true
    }
} %}

{% block form %}
{{parent()}}
<script type="text/javascript">
    let paginationLinks = document.getElementsByClassName("pagination__step");

    for (const pageLink of paginationLinks) {
        pageLink.addEventListener("click", paginationButtonClick);
    }

    function paginationButtonClick(ev) {
        let clickedLink = ev.target.href;
        let splitLink = clickedLink.split("?");
        ev.target.href = splitLink[0] + "{{ app.request.attributes.get('categoryPath') }}?"  + splitLink[1];
    }
</script>
{% endblock %}
