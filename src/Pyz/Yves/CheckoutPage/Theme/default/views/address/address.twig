{% extends view('address', '@SprykerShop:CheckoutPage') %}

{% define data = {
    isBillingSameAsShippingChecked: _view.isBillingSameAsShippingChecked,
    merchantName: app['merchant_name'] | default,
} %}

{% block content %}
    {% set jsAddressClass = 'js-address' %}

    {% embed molecule('form') with {
        modifiers: ['checkout-actions', 'checkout-form-elements'],
        data: {
            form: data.forms.address,
            submit: {
                enable: true,
                text: 'general.next.button' | trans,
                class: 'button button--expand-tablet ' ~ jsAddressClass ~ '__form-submit',
            },
        },
        embed: {
            forms: {
                shipping: data.forms.shipping,
                billing: data.forms.billing,
                items: data.forms.items,
                bundleItems: data.forms.bundleItems
            },
            isMultipleShipmentEnabled: data.isMultipleShipmentEnabled,
            jsAddressClass: jsAddressClass,
            isBillingSameAsShippingChecked: data.isBillingSameAsShippingChecked,
        },
    } only %}
        {% block fieldset %}
            <script>
                window.dataLayer.push({
                    'event': 'eec.checkout',
                    'ecommerce':
                        {
                            'checkout':
                                {
                                    'actionField':
                                        {
                                            'step': '2',
                                            'option': 'Abholstation',
                                        }
                                },
                        },
                });
            </script>
            <div class="{{ config.name }}__fields grid grid--indent">
                <div class="col col--sm-12 col--xl-6 spacing-x spacing-x--big spacing-x--inner spacing-bottom spacing-bottom--bigger">
                    <div class="checkout-block">
                        {% set idCustomer = data.form.vars.value.customer.idCustomer %}
                        <input id="idCustomer" type="hidden" value="{{ idCustomer }}" />

                        <h2 class="title title--primary checkout-block__title-with-link">
                            <div>{{ 'page.checkout.address.billing-address' | trans }}</div>
                        </h2>
                        {% if idCustomer is not null %}
                            {% set customerData = data.form.vars.value.customer %}
                            <div>{{ customerData.company }} {{ customerData.firstName }} {{ customerData.lastName }}</div>
                            <div>{{ customerData.address1 }} {{ customerData.address2 }}</div>
                            <div>{{ customerData.zipCode }} {{ customerData.city }}</div>
                            <br>
                            <div>{{ customerData.email }}</div>
                            <hr style="border-bottom: 1px solid black !important; margin:1.5rem 0 !important;">
                            <div class="text-color-1">
                                {{ 'page.checkout.address.phone.paragraph1' | trans }}
                            </div>
                            <div>
                                {{ 'page.checkout.address.phone.paragraph2' | trans }}
                            </div>
                            <br>
                            <div class="text-color-1" id="phoneRequiredFields">
                                {{ 'page.checkout.address.phone.paragraph3' | trans }}
                                <br>
                            </div>

                            {{ form_row(embed.forms.shipping.phone, { value: customerData.phone }) }}
                            <br>
                            {{ form_row(embed.forms.shipping.cell_phone, { value : customerData.mobilePhoneNumber }) }}
                            {{ form_row(embed.forms.shipping.salutation, { value: customerData.salutation, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.first_name, { value: customerData.firstName, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.last_name, { value: customerData.lastName, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.address1, { value: customerData.address1, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.address2, { value: customerData.address2, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.floor, { value: customerData.floor, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.additional_info, { value: customerData.additionalInfo, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.zip_code, { value: customerData.zipCode, rowAttr: { class: 'is-hidden' } }) }}
                            {{ form_row(embed.forms.shipping.city, { value: customerData.city, rowAttr: { class: 'is-hidden' } }) }}

                            {% include molecule('form') with {
                                modifiers: ['checkout-form', 'checkout-form-elements'],
                                data: {
                                    form: embed.forms.shipping,
                                    enableStart: false,
                                    enableEnd: false,
                                    layout: {
                                        salutation: 'col col--sm-12 col--lg-3 is-hidden',
                                        first_name: 'col col--sm-12 col--lg-4 is-hidden',
                                        last_name: 'col col--sm-12 col--lg-5 is-hidden',
                                        address1: 'col col--sm-12 col--md-8 col--lg-7 is-hidden',
                                        address2: 'col col--sm-12 col--md-4 col--lg-5 is-hidden',
                                        floor: 'col col--sm-12 col--lg-12 is-hidden',
                                        zip_code: 'col col--sm-12 col--lg-5 is-hidden',
                                        city: 'col col--sm-12 col--lg-7 is-hidden',
                                        additional_info: 'is-hidden',
                                        id_customer_address: 'is-hidden',
                                        isAddressSavingSkipped: 'is-hidden'
                                    }
                                },
                            } only %}

                        {% else %}
                            {% include molecule('form') with {
                                class: embed.jsAddressClass ~ '__shipping',
                                modifiers: ['checkout-form', 'checkout-form-elements'],
                                data: {
                                    form: embed.forms.shipping,
                                    enableStart: false,
                                    enableEnd: false,
                                    layout: {
                                        salutation: 'col col--sm-12 col--lg-3',
                                        first_name: 'col col--sm-12 col--lg-4',
                                        last_name: 'col col--sm-12 col--lg-5',
                                        address1: 'col col--sm-12 col--md-8 col--lg-7',
                                        address2: 'col col--sm-12 col--md-4 col--lg-5',
                                        floor: 'col col--sm-12 col--lg-12',
                                        zip_code: 'col col--sm-12 col--lg-5',
                                        city: 'col col--sm-12 col--lg-7',
                                        id_customer_address: 'is-hidden',
                                        isAddressSavingSkipped: 'is-hidden'
                                    }
                                  },
                            } only %}
                            <div class="form__field text-color-1" id="phoneRequiredFieldsGuest">
                                {{ 'page.checkout.address.phone.paragraph3' | trans }}
                            </div>

                        {% endif %}

                        {% if embed.isMultipleShipmentEnabled %}
                            {% include molecule('address-item-form', 'CheckoutPage') with {
                                class: 'is-hidden spacing-bottom ' ~ embed.jsAddressClass ~ '__items-target',
                                data: {
                                    form: embed.forms.items,
                                    formBundle: embed.forms.bundleItems,
                                    shippingForm: embed.forms.shipping,
                                    jsAddressClass: embed.jsAddressClass,
                                },
                            } only %}
                        {% endif %}
                    </div>
                </div>

                <div class="col col--sm-12 col--xl-6 spacing-x spacing-x--big spacing-x--inner">
                    <div class="checkout-block">
                        <h2 class="title title--primary">{{ 'page.checkout.address.abhol-address' | trans }}</h2>

                        <p class="spacing-bottom spacing-bottom--bigger text-color-1">{{ 'cart.checkout.address.abholstation.note.up' | trans }}</p>

                        <div class="spacing-bottom spacing-bottom--bigger text-color-1">
                            <p>Abholstation</p>
                            <span>
                                {{- app['merchant_name'] -}}
                            </span>
               {#             {% if data.merchantName is defined %}
                               <span class="{{ config.name }}__text">{{ data.merchantName }}</span>
                         {% endif %}#}
                        </div>
                        <div class="text-color-1">
                            <p>Nachricht an die Abholstation</p>
                        </div>
                        <div class="spacing-bottom text-color-1">
                            {{ form_row(data.form.cart_note, {
                                placeholder: 'cart.checkout.address.abholstation.textarea.note' | trans,
                            }) }}
                        </div>
                        <div class="{{ embed.jsAddressClass }}__billing-same-as-shipping is-hidden">
                            {{ form_row(data.form.billingSameAsShipping, {
                                label: 'page.checkout.address.billing-same-as-shipping' | trans,
                                component: molecule('toggler-checkbox'),
                                attributes: {
                                    'target-class-name': embed.jsAddressClass ~ '__billing-address',
                                    'add-class-when-checked': true,
                                    'checked': embed.isBillingSameAsShippingChecked,
                                },
                            }) }}
                        </div>

                        {% embed molecule('form') with {
                            class: 'spacing-top spacing-top--big is-hidden ' ~ embed.jsAddressClass ~  '__billing-address',
                            modifiers: ['checkout-form-elements'],
                            data: {
                                form: embed.forms.billing,
                                enableStart: false,
                                enableEnd: false,
                                layout: {
                                    salutation: 'col col--sm-12 col--lg-3',
                                    first_name: 'col col--sm-12 col--lg-4',
                                    last_name: 'col col--sm-12 col--lg-5',
                                    address1: 'col col--sm-12 col--md-8 col--lg-7',
                                    address2: 'col col--sm-12 col--md-4 col--lg-5',
                                    floor: 'col col--sm-12 col--lg-12',
                                    zip_code: 'col col--sm-12 col--lg-5',
                                    city: 'col col--sm-12 col--lg-7',
                                },
                            },
                            embed: {
                                jsAddressClass: embed.jsAddressClass,
                            },
                        } only %}
                            {% block fields %}
                                {% set hasBillingAddresses = data.form.id_customer_address is defined %}

                                {% if hasBillingAddresses %}
                                    {{ form_row(data.form.id_customer_address, {
                                        label: 'page.checkout.address.billing.address_select' | trans,
                                        rowAttr: {
                                            class: config.name ~ '__expand',
                                        },
                                    }) }}
                                {% endif %}

                               <div class="{{ config.name }}__checkout-sub-form">
                                   <div class="{{ embed.jsAddressClass }}__billing {{ hasBillingAddresses ? 'is-hidden' }}">
                                       {{ parent() }}
                                   </div>
                               </div>
                           {% endblock %}
                       {% endembed %}
                   </div>
                </div>
            </div>
        {% endblock %}

        {% block actions %}
            <div class="{{ config.name }}__actions spacing-top spacing-top--bigger">
                <button id="js-address__buttonSubmit" type="submit" class="{{ data.submit.class }}">{{ data.submit.text }}</button>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function(event) {
                    const phoneDivElement = document.getElementById("addressesForm_shippingAddress_phone").parentElement;
                    const idCustomer = document.getElementById("idCustomer").value;
                    if (idCustomer === "") {
                        const phoneRequiredFieldsGuest = document.getElementById('phoneRequiredFieldsGuest');
                        phoneDivElement.parentNode.insertBefore(phoneRequiredFieldsGuest, phoneDivElement)
                    }
                });

                const submitButton = document.getElementById("js-address__buttonSubmit");
                submitButton.addEventListener("click", displayMessageRequiredField);

                function displayMessageRequiredField() {
                    const phoneNumber = document.getElementById("addressesForm_shippingAddress_phone");
                    const mobileNumber = document.getElementById("addressesForm_shippingAddress_cell_phone");
                    const idCustomer = document.getElementById("idCustomer").value;
                    if (phoneNumber.value === "" && mobileNumber.value === "") {
                        event.preventDefault();
                        if (phoneNumber.value === "") {
                            phoneNumber.style.borderColor = '#cb3d49';
                        }
                        if (mobileNumber.value === "") {
                            mobileNumber.style.borderColor = '#cb3d49';
                        }
                        if (idCustomer !== "") {
                            const phoneRequiredFields = document.getElementById('phoneRequiredFields');
                            phoneRequiredFields.style.color = '#cb3d49';
                        } else {
                            const phoneRequiredFieldsGuest = document.getElementById('phoneRequiredFieldsGuest');
                            phoneRequiredFieldsGuest.style.color = '#cb3d49';
                        }
                    }
                }
            </script>
        {% endblock %}
    {% endembed %}
{% endblock %}
