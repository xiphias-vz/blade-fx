{% extends model('component') %}

{% define config = {
    name: 'summary-sidebar',
} %}

{% define data = {
    shipment: required,
    isGiftCardExists: false,
    canEdit: false,
    billingAddress: null,
    payment: null,
    merchantName: app['merchant_name'] | default,
    cartNote: _view.quoteTransfer.cartNote,
} %}

{% block body %}
    {% block adress %}
        <div class="{{ config.name }}__item col col--sm-12">
            <div class="{{ config.name }}__row">
                <div class="{{ config.name }}__col {{ config.name }}__col--wide">
                    {% block addressHeading %}
                        <div class="{{ config.name }}__heading">
                            <h2 class="{{ config.name }}__title"></h2>

                            {% if data.canEdit %}
                                <a href="{{ url('checkout-address') }}" class="link link--darkest link--edit">
                                    {% include molecule('icon-tooltip') with {
                                        modifiers: ['medium-up'],
                                        data: {
                                            icon: 'edit',
                                            text: 'general.edit.button' | trans,
                                        },
                                    } only %}
                                </a>
                            {% endif %}
                        </div>
                    {% endblock %}
                </div>

                {% if data.billingAddress %}
                    <div class="{{ config.name }}__col">
                        {% block billingAddress %}
                            {% set address = data.billingAddress %}
                            {% set fullShippingName = address.firstName ~ ' ' ~ address.lastName %}
                            {% set fullAddress = address.address1 ~ ' ' ~ address.address2 ~ ' ' ~ (address.floor | default | trans) ~ ',' %}

                            <span class="{{ config.name }}__title">{{ 'checkout.step.summary.billing_address' | trans }}</span>

                            {% if address.company %}
                                <span class="{{ config.name }}__text">{{ address.company }}</span>
                            {% endif %}

                            <span class="{{ config.name }}__text">{{ fullShippingName }}</span>
                            <span class="{{ config.name }}__text">{{ fullAddress }}</span>

                            {% if address.phone %}
                                <span class="{{ config.name }}__text">{{ address.phone }}</span>
                            {% endif %}

                            <span class="{{ config.name }}__text">{{ address.zipCode }}, {{ ('countries.iso.' ~ address.iso2code) | trans }}</span>
                        {% endblock %}
                    </div>
                {% endif %}
                <div class="{{ config.name }}__col">
                    {% block method %}
                        <span class="{{ config.name }}__title">{{ data.shipment.method.carrierName | trans }}</span>

                        {% if data.merchantName is defined %}
                            <span class="{{ config.name }}__text">{{ data.merchantName }}</span>
                        {% endif %}

                        <span class="{{ config.name }}__text">{{ data.shipment.method.name | trans }}: {{ data.shipment.method.storeCurrencyPrice | money(true, data.shipment.method.currencyIsoCode) }}</span>
                    {% endblock %}

                    {% block message_for_picker %}
                        <div style="margin-top: 15px">
                            <span class="{{ config.name }}__title {{ config.name }}__title--sub">{{ 'cart.checkout.address.abholstation.note.down' | trans }}</span>
                            <span>{{ data.cartNote }} </span>
                        </div>
                    {% endblock %}
                </div>
            </div>
        </div>
    {% endblock %}

    {% if not data.isGiftCardExists %}
        {% block delivery %}
            <div class="{{ config.name }}__item col col--sm-12">
                <div class="{{ config.name }}__row">
                    <div class="{{ config.name }}__col {{ config.name }}__col--wide">
                        {% block shippingHeading %}
                            <div class="{{ config.name }}__heading">
                                <h2 class="{{ config.name }}__title">{{ 'checkout.step.shipment.title' | trans }}</h2>

                                {% if data.canEdit %}
                                    <a href="{{ url('checkout-shipment') }}" class="link link--darkest link--edit">
                                        {% include molecule('icon-tooltip') with {
                                            modifiers: ['medium-up'],
                                            data: {
                                                icon: 'edit',
                                                text: 'general.edit.button' | trans,
                                            },
                                        } only %}
                                    </a>
                                {% endif %}
                            </div>
                        {% endblock %}
                    </div>

                    <div class="{{ config.name }}__col">
                        {% block date %}
                            {% set splittedDeliveryDate = data.shipment.requestedDeliveryDate | split('_') %}
                            <span class="{{ config.name }}__text">{{  splittedDeliveryDate | first | formatDate }} - {{ splittedDeliveryDate | last }}</span>
                        {% endblock %}
                    </div>
                </div>
            </div>
        {% endblock %}
    {% endif %}
{% endblock %}
