{% extends model('component') %}

{% define config = {
    name: 'wishlist-selector'
} %}

{% define data = {
    sku: required,
    idProductConcrete: required
} %}

{% set isUserLoggedIn = is_granted('ROLE_USER') %}
{% set disableAddToWishlist = data.idProductConcrete is empty %}

{% block body %}
    {% if isUserLoggedIn %}
        {% include molecule('ajax-provider') with {
            class: config.jsName ~ '__provider',
            attributes: {
                'url': path('wishlist/add-to-wishlist'),
                'fetch-on-load': true
            }
        } only %}

        {% include molecule('ajax-loader') with {
            modifiers: ['solid-bg'],
            data: {
                showSpinnerOnLoad: true,
            },
            attributes: {
                'provider-class-name': config.jsName ~ '__provider',
            },
        } only %}
    {% endif %}

    <form method="POST" action="{{ path('wishlist/add-item', { sku: data.sku }) }}" class="{{config.name}}__form"
          onSubmit="document.getElementsByClassName('wishlist-quantity__input')[0].value = document.getElementsByClassName('quantity-counter__input')[0].value;">
        <div class="grid grid--justify spacing-top spacing-top--big">
            <div class="col col--sm-12 col--lg-10 spacing-bottom">
                {% if isUserLoggedIn %}
                    {% include molecule('ajax-renderer') with {
                        attributes: {
                            'provider-class-name': config.jsName ~ '__provider',
                            'mount-after-render': true,
                        },
                    } only %}
                {% endif %}
                <input type="hidden" name="token" value="{{ csrf_token('add-to-wishlist') }}"/>
                <input type="hidden" name="quantity" class="wishlist-quantity__input"/>
            </div>

            <div class="col col--sm-12 col--lg-2 text-right spacing-bottom">
                <button type="submit" class="button button--hollow button--collapsed" {{ disableAddToWishlist ? 'disabled' }}>
                    {% include atom('icon') with {
                        modifiers: ['big'],
                        data: {
                            name: 'create-list',
                        },
                    } only %}
                </button>
            </div>
        </div>
    </form>
{% endblock %}
