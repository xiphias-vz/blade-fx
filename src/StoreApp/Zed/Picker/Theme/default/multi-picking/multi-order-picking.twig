{% extends template('page-layout-main') %}

{% define data = {
    currentPositionData: currentPositionData,
    pickingOrderItemsData: pickingOrderItemsData,
    itemsCount: itemsCount,
    requestParamIdSalesOrder: requestParamIdSalesOrder,
    orderReference: orderReference,
    urlContainerSelect: urlContainerSelect,
    urlPosListe: urlPosListe,
    isLastPosition: isLastPosition,
    urlMultiPickingOverview: urlMultiPickingOverview,
    urlScanShelves: urlScanShelves,
    orderPosition: orderPosition,
    orderItemPosition: orderItemPosition,
    listOfContainers: listOfContainers,
    openModal: openModal,
    fromPosListeAndModal: fromPosListeAndModal,
    openedItems: openedItems,
    editedItems: editedItems,
    isMultiPickingProcess: isMultiPickingProcess,
    orderItemStatus: orderItemStatus,
    itemPickingStartTime: itemPickingStartTime,
    isSubstitutionAllowed: isSubstitutionAllowed,
    isSubstitutionFound: isSubstitutionFound,
} %}

 {% if data.currentPositionData is defined %}
     {% set currentPosition = data.currentPositionData %}
     {% set pickingOrderItems = data.pickingOrderItemsData %}

     {% if currentPosition.weight is defined %}
         {% set weightField = currentPosition.weight / 10 %}
     {% else %}
         {% set weightField = null %}
     {% endif %}
 {% else %}

     {% set pickingOrderItem = [] %}
     {% set weightField = null %}
 {% endif %}


{% block header %}
    {% embed organism('header') with {
        modifiers: ['picking-detail'],
        data: {
            withoutLogo: true,
            orderId: data.orderReference,
            buttonUrl: '',
            orderReference: data.orderReference,
            containerSelect: true,
            pickingForm: true,
            productsLength: data.itemsCount,
            openedItems: data.openedItems,
            editedItems: data.editedItems,
            isMultiPickingProcess: data.isMultiPickingProcess
        },
        embed: {
            itemsCount: data.itemsCount,
            idOrder: currentPosition.idOrder,
            orderItemPosition: data.orderItemPosition
        }

    } only %}
        {% block headerBottom %}
            {% include molecule('pick-products-multiple-picking') with {
                data: {
                    productsLength: embed.itemsCount,
                },
                attributes: {
                    'products-count': embed.itemsCount,
                    'order-id': embed.idOrder,
                    'position': embed.orderItemPosition,
                },
            } only %}
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block content %}
    {% if app.pickingAppNewVersionVisible == true %}

        {% embed molecule('product-item-multiple-picking') with {
            class: 'spacing-top spacing-top--big',
            data: {
                currentPositionData: currentPosition,
                pickingOrderItemsData: pickingOrderItems,
                productsCount: currentPosition.quantity,
                idSalesOrder: currentPosition.idOrder,
                urlContainerSelect: data.urlContainerSelect,
                orderPosition: data.orderPosition,
                orderItemPosition: data.orderItemPosition,
                urlMultiPickingOverview: data.urlMultiPickingOverview,
                urlPosListe: data.urlPosListe,
                listOfContainers: data.listOfContainers,
                isLastPosition: data.isLastPosition,
                urlScanShelves: data.urlScanShelves,
                openModal: data.openModal,
                fromPosListeAndModal: data.fromPosListeAndModal,
                orderItemStatus: data.orderItemStatus,
                itemPickingStartTime: data.itemPickingStartTime,
                isSubstitutionAllowed: data.isSubstitutionAllowed,
                isSubstitutionFound: data.isSubstitutionFound
            },
            attributes: {
                'data-sku': currentPosition.ean,
            },
            embed: {
                weightField: weightField,
            }
        } only %}
            {% block formElement %}

            {% endblock %}

            {% block formElementWeight %}

            {% endblock %}
        {% endembed %}

    {% else %}

        <!-- OLD: multi-picking/multi-order-picking.twig -->
        {% embed molecule('product-item-multiple-picking-old') with {
            class: 'spacing-top spacing-top--big',
            data: {
                currentPositionData: currentPosition,
                pickingOrderItemsData: pickingOrderItems,
                productsCount: currentPosition.quantity,
                idSalesOrder: currentPosition.idOrder,
                urlContainerSelect: data.urlContainerSelect,
                orderPosition: data.orderPosition,
                orderItemPosition: data.orderItemPosition,
                urlMultiPickingOverview: data.urlMultiPickingOverview,
                urlPosListe: data.urlPosListe,
                listOfContainers: data.listOfContainers,
                isLastPosition: data.isLastPosition,
                urlScanShelves: data.urlScanShelves,
                openModal: data.openModal,
                fromPosListeAndModal: data.fromPosListeAndModal,
                orderItemStatus: data.orderItemStatus,
                itemPickingStartTime: data.itemPickingStartTime,
                isSubstitutionAllowed: data.isSubstitutionAllowed,
                isSubstitutionFound: data.isSubstitutionFound
            },
            attributes: {
                'data-sku': currentPosition.ean,
            },
            embed: {
                weightField: weightField,
            }
        } only %}
            {% block formElement %}

            {% endblock %}

            {% block formElementWeight %}

            {% endblock %}
        {% endembed %}

    {% endif %}

    <input type="hidden" name="{{ data.requestParamIdSalesOrder }}" value="{{ currentPosition.idOrder }}">

{% endblock %}
