{% extends model('component') %}

{% define config = {
    name: 'product-item',
    tag: 'product-item',
} %}

{% define data = {
    imageUrl: '',
    title: '',
    productsCount: 1,
    itemSku: '',
    itemsToShelfMap: [],
    itemsToProductAttributesMap: [],
    field: required,
    urlContainerSelect: '',
    collectNumber: 0,
    itemsCount: 1,
    idSalesOrder: 0,
    pickedItemsCount: pickedItemsCount|default(null),
    notPickedItemsCount: notPickedItemsCount|default(null)
} %}

{% set shelfData = data.itemsToShelfMap[data.itemSku] %}
{% set itemsToShelfMap = data.itemsToProductAttributesMap[data.itemSku] %}
{% set imageUrl = data.imageUrl %}
{% set shelfData = data.itemsToShelfMap[data.itemSku] %}
{% set title = data.field.vars.label %}
{% set productsCount = data.field.vars.attr.max %}

{% block body %}
    <div class="grid {{ config.name }}__card" data-sku="{{ data.itemSku }}">
        <div class="col col--expand">
            <div class="box {{ config.name }}__info">
                <div class="{{ config.name }}__item-location">
                    <p>{{ shelfData['shelf'] ?? ''}}-{{ shelfData['shelfField'] ?? ''}}-{{ shelfData['shelfFloor'] ?? ''}}</p>
                </div>
                <div class="{{ config.name }}__image-wrapper">
                    {% include atom('thumbnail') with {
                        modifiers: ['product'],
                        attributes: {
                            src: data.imageUrl,
                            alt: data.title
                        }
                    } only %}
                </div>
                <div class="{{ config.name }}__generalInfo">
                    {% block brandNameAndWeight %}
                        {% set sumPrice = shelfData['sumPrice'] ?? '' %}
                        <div class="{{ config.name }}__supplierNameAndWeight"><span class="{{ config.name }}__supplierAndName col--md-8">{{ itemsToShelfMap['brand'] ?? '' }} - {{ title|split('-')[1] }}</span><span class="{{ config.name }}__weight col--md-4">{{ (itemsToShelfMap['basePriceContent'] / 100)  | replace('.', ',') }} {{ itemsToShelfMap['basePriceUnit'] }}</span></div>
                        <div id="ean" class="{{ config.name }}__eanAndWeight" data-pricePerKg="{{ itemsToShelfMap['pricePerKg'] }}" data-ean="{{ data.itemSku }}"><span class="{{ config.name }}__ean col--md-8">EAN: {{ data.itemSku ?? '' }}</span><span class="{{ config.name }}__price col--md-4">{{ sumPrice / 100 | replace('.', ',') }} â‚¬</span></div>
                    {% endblock %}
                    <div class="hr-line-solid"></div>
                </div>

                <span id="alternativeEan" data-altEan="{{ data.alternativeEanData }}"></span>

                <div class="{{ config.name }}__status">
                    {% include atom('icon') with {
                        class: config.name ~ '__icon-close',
                        data: {
                            name: 'close'
                        }
                    } only %}
                    {% include atom('icon') with {
                        class: config.name ~ '__icon-check',
                        data: {
                            name: 'check'
                        }
                    } only %}
                </div>
                {% block quantity %}
                    {% if data.productsCount >= 1 %}
                        <div class="{{ config.name }}__quantity">
                            <div class="{{ config.jsName }}__minus {{ config.name }}__minus spacing-right spacing-right--inner">
                                {% include atom('icon') with {
                                    data: {
                                        name: 'remove'
                                    }
                                } only %}
                            </div>
                            <div class="box box--white box--bordered box--spaceless {{ config.name }}__counter text-center">
                                <span class="{{ config.jsName }}__quantity-output">
                                    0
                                </span>
                                {{ 'of' | trans }} {{ data.productsCount }}
                            </div>
                            <div class="{{ config.jsName }}__plus {{ config.name }}__plus spacing-left spacing-left--inner">
                                {% include atom('icon') with {
                                    data: {
                                        name: 'add'
                                    }
                                } only %}
                            </div>
                        </div>
                    {% endif %}
                    <div class="is-hidden">
                        {% block formElement %}{% endblock %}
                    </div>
                {% endblock %}


                {% block formElementWeight %}
                    {% if embed.weightField %}
                        {{ form_row(embed.weightField, {
                            attr: {
                                class: config.jsName ~ '__weight',
                            }
                        }) }}
                    {% endif %}
                {% endblock %}

                {% block formElementScan %}<div id="eanScannenDiv"><input id="txt_ean_scannen" placeholder="EAN scannen" class="input input--expand" type="text" /></div>{% endblock %}
            </div>
        </div>
    </div>

    <div class="grid grid--justify spacing-top">
        {% block leftCol %}
            <div class="col button button--round button--delete {{ config.name }}__decline {{ config.jsName }}__decline">
                {% include atom('icon') with {
                    class: 'button__icon ' ~ config.name ~ '__close',
                    data: {
                        name: 'close'
                    }
                } only %}
                {% include atom('icon') with {
                    class: 'button__icon ' ~ config.name ~ '__undo',
                    data: {
                        name: 'undo'
                    }
                } only %}
            </div>
        {% endblock %}
        {% block midCol %}
            <div class="col button button--round button--disabled button--pause {{ config.name }}__pause {{ config.jsName }}__pause">
                {% include atom('icon') with {
                    class: 'button__icon',
                    data: {
                        name: 'pause'
                    }
                } only %}
            </div>
        {% endblock %}
        {% block rightCol %}
            <div class="col button button--round button--accept {{ config.name }}__pick {{ config.jsName }}__accept">
                {% include atom('icon') with {
                    class: 'button__icon ' ~ config.name ~ '__accept',
                    data: {
                        name: 'add'
                    }
                } only %}
            </div>

            <div class="pick-products__action-wrapper button--confirm">
                <div class="pick-products__action js-pick-products__action">
                    {% embed molecule('popup-ui') with {
                        data: {
                            buttons: {
                                submit: {
                                    isButton: true,
                                    additionalClass: 'js-pick-products__submit',
                                },
                            },
                        },
                        embed: {
                            collectNumber: data.collectNumber,
                            itemsCount: data.itemsCount,
                        },
                    } only %}
                        {% block content %}
                            <div class="grid grid--center">
                                <div class="total-articles grid">
                                    <p class="total-amount">{{ embed.itemsCount }}</p>
                                    <p>{{ 'Artikel' | trans }}</p>
                                </div>
                            </div>
                            <div class="store-app-label-holder">
                                <div class="grid grid--center spacing-y-label">
                                    <div class="col--sm-12 grid">
                                        <table>
                                            <tr>
                                                <td class="item-quantity">
                                                    {% embed atom('store-app-label') with {
                                                        modifiers: ['picked', 'count'],
                                                    } only %}
                                                        {% block body %}
                                                            <span class="js-pick-products__picked">0</span>
                                                        {% endblock %}
                                                    {% endembed %}
                                                </td>
                                                <td>
                                                    <div class="label-text-green">
                                                        {{ 'picked' | trans }}
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="grid grid--center spacing-y-label">
                                    <div class="col--sm-12 grid">
                                        <table>
                                            <tr>
                                                <td class="item-quantity">
                                                    {% embed atom('store-app-label') with {
                                                        modifiers: ['not-found', 'count'],
                                                    } only %}
                                                        {% block body %}
                                                            <span class="js-pick-products__not-picked">0</span>
                                                        {% endblock %}
                                                    {% endembed %}
                                                </td>
                                                <td>
                                                    <div class="label-text-brown">
                                                        {{ 'not found' | trans }}
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>

                                    </div>
                                </div>
                                <div class="grid grid--center spacing-bottom spacing-bottom--big">
                                    <div class="col--sm-12 grid">
                                        <table>
                                            <tr>
                                                <td class="item-quantity">
                                                    {% embed atom('store-app-label') with {
                                                        modifiers: ['bordered', 'count'],
                                                    } only %}
                                                        {% block body %}
                                                            <span class="js-pick-products__bags">1</span>
                                                        {% endblock %}
                                                    {% endembed %}
                                                </td>
                                                <td>
                                                    <div class="label-text">
                                                        {{ 'bags' | trans }}
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                            </div>
                            <div class="horizontal-spacing">
                                {% if embed.collectNumber %}
                                    <div class="text-center spacing-top--big">
                                        <p class="text-bold spacing-bottom">{{ 'Collect Number' | trans }}: {{ embed.collectNumber }}</p>
                                    </div>
                                {% endif %}
                            </div>
                        {% endblock %}

                        {% block button %}
                            <div id="btnSubmitPick" class="col button button--confirm-btn button--round button--disabled js-pick-products__submit-button js-pick-products__submit">
                                {{ 'picker.picking.confirmation' | trans }}
                            </div>
                        {% endblock %}

                    {% endembed %}
                </div>
            </div>
        {% endblock %}
    </div>



{% endblock %}
