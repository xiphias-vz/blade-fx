<?xml version="1.0"?>
<statemachine
    xmlns="spryker:oms-01"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="spryker:oms-01 http://static.spryker.com/oms-01.xsd">

    <process name="StorePicking01">
        <subprocesses>
            <process>CashierExport</process>
            <process>StoreDelivery</process>
        </subprocesses>

        <states>
            <state name="started order processing">
                <flag>cancellable by customer</flag>
            </state>
            <state name="ready to start picking">
                <flag>cancellable by backoffice</flag>
            </state>
            <state name="ready for picking">
                <flag>cancellable by backoffice</flag>
            </state>

            <state name="ready for selecting shelves">
                <flag>cancellable by backoffice</flag>
            </state>

            <state name="picked">
                <flag>cancellable by backoffice</flag>
            </state>

            <state name="cancelled due to not in stock">
                <flag>cancelled</flag>
                <flag>shipped mail awaits</flag>
            </state>
        </states>

        <transitions>
            <transition happy="true">
                <source>confirmed</source>
                <target>ready for picking</target>
                <event>move to ready for picking</event>
            </transition>

            <transition happy="true">
                <source>ready for picking</source>
                <target>ready for selecting shelves</target>
                <event>confirm selecting containers</event>
            </transition>

            <transition>
                <source>ready for picking</source>
                <target>cancelled by backoffice</target>
                <event>cancel by backoffice</event>
            </transition>

            <transition happy="true">
                <source>ready for selecting shelves</source>
                <target>picked</target>
                <event>confirm picking</event>
            </transition>

            <transition>
                <source>ready for selecting shelves</source>
                <target>cancelled by backoffice</target>
                <event>cancel by backoffice</event>
            </transition>

            <transition>
                <source>picked</source>
                <target>ready for picking</target>
                <event>Zurücksetzen</event>
            </transition>

            <transition>
                <source>picked</source>
                <target>cancelled by backoffice</target>
                <event>cancel by backoffice</event>
            </transition>

            <transition>
                <source>cancelled</source>
                <target>ready for picking</target>
                <event>Zurücksetzen</event>
            </transition>

            <transition>
                <source>ready for picking</source>
                <target>cancelled due to not in stock</target>
                <event>cancel due to not in stock</event>
            </transition>

            <transition>
                <source>cancelled due to not in stock</source>
                <target>cancellation process</target>
                <event>process cancelled due to not in stock</event>
            </transition>

            <transition happy="true" condition="wait all items in picked or canceled state">
                <source>picked</source>
                <target>cashier export process</target>
            </transition>

            <transition happy="true">
                <source>collected by customer</source>
                <target>accepted by customer</target>
                <event>pass 1 second</event>
            </transition>

            <transition happy="true">
                <source>delivered to customer</source>
                <target>accepted by customer</target>
                <event>pass 1 second</event>
            </transition>

            <transition>
                <source>cancelled by backoffice</source>
                <target>release time slot and cancel</target>
                <event>pass</event>
            </transition>
        </transitions>

        <events>
            <event name="move to ready for picking" onEnter="true" command="Sales/MoveToReadyForPicking"/>
            <event name="confirm selecting containers" manual="true" command="Sales/ConfirmSelectingContainers"/>
            <event name="Zurücksetzen" manual="true" command="Sales/ResetPickZone" />
            <event name="confirm picking" manual="true" command="Sales/ConfirmPicking"/>
            <event name="cancel due to not in stock" manual="true"/>
            <event name="process cancelled due to not in stock" onEnter="true" command="Oms/CancelDueToNotInStock"/>
            <event name="cancel by backoffice" manual="true" command="OrderCancelByBackoffice"/>
            <event name="close order" manual="true"/>
        </events>
    </process>

    <process name="CashierExport" file="CashierExport01.xml"/>
    <process name="StoreDelivery" file="StoreDelivery01.xml"/>

</statemachine>
