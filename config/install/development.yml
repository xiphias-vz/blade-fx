env:
    APPLICATION_ENV: development

stores:
    - BERLIN
    - HAMBURG

command-timeout: 3600

sections:

    environment:
        console-environment:
            command: "if [ ! -f ./config/Shared/console_env_local.php ]; then cp ./config/Shared/console_env_local.dist.php ./config/Shared/console_env_local.php ; fi"


    clear:
        remove-logs:
            command: "vendor/bin/console log:clear"

        remove-cache:
            command: "vendor/bin/console clear:directory:cache"

        remove-generated-files:
            command: "vendor/bin/console setup:empty-generated-directory"

    generate:
        generate-transfers:
            command: "vendor/bin/console transfer:generate"

        generate-transfer-databuilders:
            command: "vendor/bin/console transfer:databuilder:generate"

        generate-ide-auto-completion:
            command: "vendor/bin/console dev:ide:generate-auto-completion"

    jenkins-down:
        jenkins-stop:
            command: "vendor/bin/console scheduler:clean"
            stores: true

    cache:
        router-cache-warmup-yves:
            command: "vendor/bin/yves router:cache:warm-up"

        router-cache-warmup-zed:
            command: "vendor/bin/console router:cache:warm-up"

        twig-cache-warmup:
            command: "vendor/bin/console twig:cache:warmer"

        navigation-cache-warmup:
            command: "vendor/bin/console navigation:build-cache"

        rest-request-validation-cache-warmup:
            command: "vendor/bin/console glue:rest:build-request-validation-cache"


    queue-flush:
        set-permissions:
            command: "vendor/bin/console queue:permission:set"
            stores: true

        purge-all-queues:
            command: "vendor/bin/console queue:queue:purge-all"
            stores: true

        delete-all-queues:
            command: "vendor/bin/console queue:queue:delete-all"
            stores: true

        delete-all-exchanges:
            command: "vendor/bin/console queue:exchanges:delete-all"
            stores: true


    database-flush:
        delete-elastic-search-index:
            command: "vendor/bin/console search:index:delete"
            stores: true
            groups:
                - elastic

        delete-storage:
            command: "vendor/bin/console storage:delete"
            stores: true
            groups:
                - redis

        drop-database:
            command: "vendor/bin/console propel:database:drop"
            stores:
                - BERLIN
            groups:
                - propel

        delete-migration-files:
            command: "vendor/bin/console propel:migration:delete"
            stores:
                - BERLIN
            groups:
                - propel


    database-migrate:
        propel-create:
            command: "vendor/bin/console propel:database:create"
            stores:
                - BERLIN
            groups:
                - propel

        propel-postgres-compatibility:
            command: "vendor/bin/console propel:pg-sql-compat"
            stores:
                - BERLIN
            groups:
                - propel

        propel-copy-schema:
            command: "vendor/bin/console propel:schema:copy"
            stores:
                - BERLIN
            groups:
                - propel

        propel-build:
            command: "vendor/bin/console propel:model:build"
            groups:
                - propel

        propel-diff:
            command: "vendor/bin/console propel:diff"
            stores:
                - BERLIN
            groups:
                - propel

        propel-migration-check:
            command: "vendor/bin/console propel:migration:check"
            breakOnFailure: false
            stores:
                - BERLIN
            groups:
                - propel

        propel-migrate:
            command: "vendor/bin/console propel:migrate"
            stores:
                - BERLIN
            groups:
                - propel

        generate-entity-transfer:
            command: "vendor/bin/console transfer:entity:generate"

        init-database:
            command: "vendor/bin/console setup:init-db"
            stores:
                - BERLIN

        setup-search-create-sources:
            command: "vendor/bin/console search:setup:sources"
            stores: true
            groups:
                - elastic

        setup-seach-create-source-map:
            command: "vendor/bin/console search:setup:source-map"
            stores: true
            groups:
                - elastic

    demodata:
        import:
            command: "vendor/bin/console data:import"
            stores:
                - BERLIN

        update-product-labels:
            command: "vendor/bin/console product-label:relations:update"
            stores:
                - BERLIN

        check-product-validity:
            command: "vendor/bin/console product:check-validity"
            stores:
                - BERLIN

    jenkins-up:
        jenkins-generate:
            command: "vendor/bin/console scheduler:setup"
            stores: true

        jenkins-enable:
            command: "vendor/bin/console scheduler:resume"
            stores: true

    frontend:
        dependencies-install:
            command: "vendor/bin/console frontend:project:install-dependencies -vvv"
            groups:
                - project

        yves-install-dependencies:
            command: "vendor/bin/console frontend:yves:install-dependencies -vvv"
            groups:
                - yves

        yves-build-frontend:
            command: "vendor/bin/console frontend:yves:build -vvv"
            groups:
                - yves

        zed-install-dependencies:
            command: "vendor/bin/console frontend:zed:install-dependencies -vvv"
            groups:
                - zed

        zed-build-frontend:
            command: "vendor/bin/console frontend:zed:build"
            groups:
                - zed

        store-app-build-frontend:
            command: "npm run storeapp"
